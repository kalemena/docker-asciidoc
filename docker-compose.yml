version: '2'
services:  
  
  # This container will start, build and exit
  asciidoc-build:
    image: asciidoctor/docker-asciidoctor
    volumes:
     - ./build.sh:/build.sh
     - ./asciidoc.conf:/root/.asciidoc/asciidoc.conf
     - ./samples:/documents/
     - docs-rendered:/documents-rendered/
    command: bash /build.sh 

  # NginX serves static pages builded above
  asciidoc-serve:
    image: nginx
    ports:
     - "8010:80"
    volumes:
     - ./default-site.conf:/etc/nginx/conf.d/default.conf
     - docs-rendered:/usr/share/nginx/html

  # # CONFLUENCE stuff here
  # confluencedb:
  #   image: postgres
  #   volumes:
  #     - ./data/postgres:/var/lib/postgresql/data
  #   environment:
  #     - 'POSTGRES_USER=confluencedb'
  #     - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
  #     - 'POSTGRES_DB=confluencedb'
  #     - 'POSTGRES_ENCODING=UTF8'
  #     - 'POSTGRES_COLLATE=C'
  #     - 'POSTGRES_COLLATE_TYPE=C'
    
  # confluence:
  #   image: atlassian/confluence-server
  #   depends_on:
  #     - confluencedb
  #   volumes:
  #    - ./data/confluence:/var/atlassian/application-data/confluence
  #    - ./data/confluence-shared:/var/atlassian/application-data/confluence-shared
  #   ports:
  #    - "8090:8090"
  #    - "8091:8091"

  # asciidoc-mvn-confluence:
  #   image: maven:3.5-jdk-8
  #   volumes:
  #     - ./data:/root
  #     - ./data/maven-doc:/data/maven-doc
  #     - ./samples:/documents/
  #     - ./build-confluence.sh:/build-confluence.sh
  #   command: bash /build-confluence.sh
  #   environment:
  #    - CONFLUENCE_SPACEKEY=${CONFLUENCE_SPACEKEY}
  #    - CONFLUENCE_ANCESTORID=${CONFLUENCE_ANCESTORID}
  #    - CONFLUENCE_USERNAME=${CONFLUENCE_USERNAME}
  #    - CONFLUENCE_PASSWORD=${CONFLUENCE_PASSWORD}

  # # MEDIAWIKI stuff here
  # mediawiki:
  #   image: mediawiki
  #   restart: always
  #   ports:
  #     - 8020:80
  #   links:
  #     - mediawikidb
  #   volumes:
  #     - /var/www/html/images
  #     # After initial setup, download LocalSettings.php to the same directory as
  #     # this yaml and uncomment the following line and use compose to restart
  #     # the mediawiki service
  #     - ./LocalSettings.php:/var/www/html/LocalSettings.php

  # mediawikidb:
  #   image: mariadb
  #   restart: always
  #   environment:
  #     # @see https://phabricator.wikimedia.org/source/mediawiki/browse/master/includes/DefaultSettings.php
  #     MYSQL_DATABASE: my_wiki
  #     MYSQL_USER: wikiuser
  #     MYSQL_PASSWORD: example
  #     MYSQL_RANDOM_ROOT_PASSWORD: "yes"

volumes:
  docs-rendered:
  